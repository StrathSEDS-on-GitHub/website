var xr=Object.defineProperty;var Er=(r,e,t)=>e in r?xr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var U=(r,e,t)=>Er(r,typeof e!="symbol"?e+"":e,t);import{f as M,a as x,t as Mr,c as Nr}from"../chunks/B99Gs2Wt.js";import{s as Q,j as H,m as qe,o as te,h as E,x as Ke,an as er,b as rr,ao as Ye,K as tr,L as Ce,w as fe,v as K,U as Le,ap as de,aq as Ae,a1 as Fe,a as ee,Q as ar,c as L,ar as je,e as kr,M as _e,N as ue,aj as Ir,q as Tr,F as Cr,Z as v,X as Fr,J as Zr,y as $r,C as sr,k as zr,as as Me,at as Dr,au as Rr,B as Wr,av as Br,d as Pr,aw as Sr,ax as Yr,r as Lr,ay as jr,az as Gr,aA as Or,aB as Qr,aC as Hr,E as Vr,aD as Ur,aE as Jr,O as Xr,g as ir,aF as qr,aG as Kr,n as J,P as et,ag as w,ah as m,af as V,G as ae,ai as b,aH as pe,I as se,ak as G,a0 as T,$ as nr,f as Ge}from"../chunks/25vezqCI.js";import{p as Oe,i as ve,b as rt}from"../chunks/CMkoJ_lK.js";import{a as tt,d as ze,s as re}from"../chunks/rnqgJxXg.js";import{s as at}from"../chunks/ByB-ed9H.js";let Qe=!1;function or(){Qe||(Qe=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function lr(r){var e=qe,t=te;Q(null),H(null);try{return r()}finally{Q(e),H(t)}}function st(r,e,t,s=t){r.addEventListener(e,()=>lr(t));const a=r.__on_r;a?r.__on_r=()=>{a(),s(!0)}:r.__on_r=()=>s(!0),or()}const Ne=0,le=1,ke=2;function it(r,e,t,s,a){E&&Ke();var i=r,n=er(),f=kr,l=Le,c,o,g,u=n?Ae(void 0):Fe(void 0,!1,!1),_=n?Ae(void 0):Fe(void 0,!1,!1),A=!1;function p(d,y){A=!0,y&&(H(h),Q(h),je(f));try{d===Ne&&t&&(c?_e(c):c=ee(()=>t(i))),d===le&&s&&(o?_e(o):o=ee(()=>s(i,u))),d!==Ne&&c&&ue(c,()=>c=null),d!==le&&o&&ue(o,()=>o=null),d!==ke&&g&&ue(g,()=>g=null)}finally{y&&(je(null),Q(null),H(null),Ir())}}var h=rr(()=>{if(l===(l=e()))return;let d=E&&Ye(l)===(i.data===tr);if(d&&(i=Ce(),fe(i),K(!1),d=!0),Ye(l)){var y=l;A=!1,y.then(I=>{y===l&&(de(u,I),p(le,!0))},I=>{if(y===l)throw de(_,I),p(ke,!0),_.v}),E?t&&(c=ee(()=>t(i))):ar(()=>{A||p(Ne,!0)})}else de(u,l),p(le,!1);return d&&K(!0),()=>l=Le});E&&(i=L)}function cr(r,e){return e}function nt(r,e,t,s){for(var a=[],i=e.length,n=0;n<i;n++)Rr(e[n].e,a,!0);var f=i>0&&a.length===0&&t!==null;if(f){var l=t.parentNode;Wr(l),l.append(t),s.clear(),P(r,e[0].prev,e[i-1].next)}Br(a,()=>{for(var c=0;c<i;c++){var o=e[c];f||(s.delete(o.k),P(r,o.prev,o.next)),Pr(o.e,!f)}})}function fr(r,e,t,s,a,i=null){var n=r,f={flags:e,items:new Map,first:null};{var l=r;n=E?fe(Tr(l)):l.appendChild(Cr())}E&&Ke();var c=null,o=!1,g=Fr(()=>{var u=t();return zr(u)?u:u==null?[]:sr(u)});rr(()=>{var u=v(g),_=u.length;if(o&&_===0)return;o=_===0;let A=!1;if(E){var p=Zr(n)===tr;p!==(_===0)&&(n=Ce(),fe(n),K(!1),A=!0)}if(E){for(var h=null,d,y=0;y<_;y++){if(L.nodeType===8&&L.data===$r){n=L,A=!0,K(!1);break}var I=u[y],N=s(I,y);d=dr(L,f,h,null,I,N,y,a,e,t),f.items.set(N,d),h=d}_>0&&fe(Ce())}E||ot(u,f,n,a,e,s,t),i!==null&&(_===0?c?_e(c):c=ee(()=>i(n)):c!==null&&ue(c,()=>{c=null})),A&&K(!0),v(g)}),E&&(n=L)}function ot(r,e,t,s,a,i,n){var f=r.length,l=e.items,c=e.first,o=c,g,u=null,_=[],A=[],p,h,d,y;for(y=0;y<f;y+=1){if(p=r[y],h=i(p,y),d=l.get(h),d===void 0){var I=o?o.e.nodes_start:t;u=dr(I,e,u,u===null?e.first:u.next,p,h,y,s,a,n),l.set(h,u),_=[],A=[],o=u.next;continue}if(lt(d,p,y),(d.e.f&Me)!==0&&_e(d.e),d!==o){if(g!==void 0&&g.has(d)){if(_.length<A.length){var N=A[0],k;u=N.prev;var C=_[0],z=_[_.length-1];for(k=0;k<_.length;k+=1)He(_[k],N,t);for(k=0;k<A.length;k+=1)g.delete(A[k]);P(e,C.prev,z.next),P(e,u,C),P(e,z,N),o=N,u=z,y-=1,_=[],A=[]}else g.delete(d),He(d,o,t),P(e,d.prev,d.next),P(e,d,u===null?e.first:u.next),P(e,u,d),u=d;continue}for(_=[],A=[];o!==null&&o.k!==h;)(o.e.f&Me)===0&&(g??(g=new Set)).add(o),A.push(o),o=o.next;if(o===null)continue;d=o}_.push(d),u=d,o=d.next}if(o!==null||g!==void 0){for(var D=g===void 0?[]:sr(g);o!==null;)(o.e.f&Me)===0&&D.push(o),o=o.next;var R=D.length;if(R>0){var ye=f===0?t:null;nt(e,D,ye,l)}}te.first=e.first&&e.first.e,te.last=u&&u.e}function lt(r,e,t,s){de(r.v,e),r.i=t}function dr(r,e,t,s,a,i,n,f,l,c){var o=(l&Sr)!==0,g=(l&Yr)===0,u=o?g?Fe(a,!1,!1):Ae(a):a,_=(l&Dr)===0?n:Ae(n),A={i:_,v:u,k:i,a:null,e:null,prev:t,next:s};try{return A.e=ee(()=>f(r,u,_,c),E),A.e.prev=t&&t.e,A.e.next=s&&s.e,t===null?e.first=A:(t.next=A,t.e.next=A.e),s!==null&&(s.prev=A,s.e.prev=A.e),A}finally{}}function He(r,e,t){for(var s=r.next?r.next.e.nodes_start:t,a=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==s;){var n=Lr(i);a.before(i),i=n}}function P(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function ct(r,e,t){var s=r==null?"":""+r;return s===""?null:s}function B(r,e,t,s,a,i){var n=r.__className;if(E||n!==t||n===void 0){var f=ct(t);(!E||f!==r.getAttribute("class"))&&(f==null?r.removeAttribute("class"):r.className=f),r.__className=t}return i}const ft=Symbol("is custom element"),dt=Symbol("is html");function X(r){if(E){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var s=r.value;Ze(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var a=r.checked;Ze(r,"checked",null),r.checked=a}}};r.__on_r=t,Gr(t),or()}}function Ze(r,e,t,s){var a=ut(r);E&&(a[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||a[e]!==(a[e]=t)&&(e==="loading"&&(r[Or]=t),t==null?r.removeAttribute(e):typeof t!="string"&&vt(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function ut(r){return r.__attributes??(r.__attributes={[ft]:r.nodeName.includes("-"),[dt]:r.namespaceURI===jr})}var Ve=new Map;function vt(r){var e=Ve.get(r.nodeName);if(e)return e;Ve.set(r.nodeName,e=[]);for(var t,s=r,a=Element.prototype;a!==s;){t=Hr(s);for(var i in t)t[i].set&&e.push(i);s=Qr(s)}return e}const At=()=>performance.now(),$={tick:r=>requestAnimationFrame(r),now:()=>At(),tasks:new Set};function ur(){const r=$.now();$.tasks.forEach(e=>{e.c(r)||($.tasks.delete(e),e.f())}),$.tasks.size!==0&&$.tick(ur)}function _t(r){let e;return $.tasks.size===0&&$.tick(ur),{promise:new Promise(t=>{$.tasks.add(e={c:r,f:t})}),abort(){$.tasks.delete(e)}}}function ce(r,e){lr(()=>{r.dispatchEvent(new CustomEvent(e))})}function pt(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ue(r){const e={},t=r.split(";");for(const s of t){const[a,i]=s.split(":");if(!a||i===void 0)break;const n=pt(a.trim());e[n]=i.trim()}return e}const gt=r=>r;function j(r,e,t,s){var a=(r&qr)!==0,i="both",n,f=e.inert,l=e.style.overflow,c,o;function g(){var h=qe,d=te;Q(null),H(null);try{return n??(n=t()(e,(s==null?void 0:s())??{},{direction:i}))}finally{Q(h),H(d)}}var u={is_global:a,in(){e.inert=f,ce(e,"introstart"),c=$e(e,g(),o,1,()=>{ce(e,"introend"),c==null||c.abort(),c=n=void 0,e.style.overflow=l})},out(h){e.inert=!0,ce(e,"outrostart"),o=$e(e,g(),c,0,()=>{ce(e,"outroend"),h==null||h()})},stop:()=>{c==null||c.abort(),o==null||o.abort()}},_=te;if((_.transitions??(_.transitions=[])).push(u),tt){var A=a;if(!A){for(var p=_.parent;p&&(p.f&Vr)!==0;)for(;(p=p.parent)&&(p.f&Ur)===0;);A=!p||(p.f&Jr)!==0}A&&Xr(()=>{ir(()=>u.in())})}}function $e(r,e,t,s,a){var i=s===1;if(Kr(e)){var n,f=!1;return ar(()=>{if(!f){var h=e({direction:i?"in":"out"});n=$e(r,h,t,s,a)}}),{abort:()=>{f=!0,n==null||n.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return a(),{abort:J,deactivate:J,reset:J,t:()=>s};const{delay:l=0,css:c,tick:o,easing:g=gt}=e;var u=[];if(i&&t===void 0&&(o&&o(0,1),c)){var _=Ue(c(0,1));u.push(_,_)}var A=()=>1-s,p=r.animate(u,{duration:l,fill:"forwards"});return p.onfinish=()=>{p.cancel();var h=(t==null?void 0:t.t())??1-s;t==null||t.abort();var d=s-h,y=e.duration*Math.abs(d),I=[];if(y>0){var N=!1;if(c)for(var k=Math.ceil(y/16.666666666666668),C=0;C<=k;C+=1){var z=h+d*g(C/k),D=Ue(c(z,1-z));I.push(D),N||(N=D.overflow==="hidden")}N&&(r.style.overflow="hidden"),A=()=>{var R=p.currentTime;return h+d*g(R/y)},o&&_t(()=>{if(p.playState!=="running")return!1;var R=A();return o(R,1-R),!0})}p=r.animate(I,{duration:y,fill:"forwards"}),p.onfinish=()=>{A=()=>s,o==null||o(s,1-s),a()}},{abort:()=>{p&&(p.cancel(),p.effect=null,p.onfinish=J)},deactivate:()=>{a=J},reset:()=>{s===0&&(o==null||o(1,0))},t:()=>A()}}function q(r,e,t=e){var s=er();st(r,"input",a=>{var i=a?r.defaultValue:r.value;if(i=Ie(r)?Te(i):i,t(i),s&&i!==(i=e())){var n=r.selectionStart,f=r.selectionEnd;r.value=i??"",f!==null&&(r.selectionStart=n,r.selectionEnd=Math.min(f,r.value.length))}}),(E&&r.defaultValue!==r.value||ir(e)==null&&r.value)&&t(Ie(r)?Te(r.value):r.value),et(()=>{var a=e();Ie(r)&&a===Te(r.value)||r.type==="date"&&!a&&!r.value||a!==r.value&&(r.value=a??"")})}function Ie(r){var e=r.type;return e==="number"||e==="range"}function Te(r){return r===""?null:+r}let O;async function ht(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function yt(){const r={};return r.wbg={},r.wbg.__wbindgen_init_externref_table=function(){const e=O.__wbindgen_export_0,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r}function mt(r,e){return O=r.exports,vr.__wbindgen_wasm_module=e,O.__wbindgen_start(),O}async function vr(r){if(O!==void 0)return O;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("data:application/wasm;base64,AGFzbQEAAAABCgJgAABgAn9/AX8CJwEDd2JnH19fd2JpbmRnZW5faW5pdF9leHRlcm5yZWZfdGFibGUAAAMCAQEEBQFvAIABBQMBABEHOQQGbWVtb3J5AgADYWRkAAETX193YmluZGdlbl9leHBvcnRfMAEAEF9fd2JpbmRnZW5fc3RhcnQAAAwBAgoJAQcAIAAgAWoLC5MHAgBBgIDAAAuAB0xhenkgaW5zdGFuY2UgaGFzIHByZXZpb3VzbHkgYmVlbiBwb2lzb25lZAAAAAAQACoAAAAvaG9tZS9reWxlLy5jYXJnby9yZWdpc3RyeS9zcmMvaW5kZXguY3JhdGVzLmlvLTE5NDljZjhjNmI1YjU1N2Yvb25jZV9jZWxsLTEuMjEuMy9zcmMvbGliLnJzADQAEABbAAAACAMAABkAAAByZWVudHJhbnQgaW5pdAAAoAAQAA4AAAA0ABAAWwAAAHoCAAANAAAAL3J1c3RjLzE2ZDIyNzZmYTZmY2NiMGNjMjM5YTU0MmQ0YzNmMGViNDZmNjYwZWMvbGlicmFyeS9hbGxvYy9zcmMvcmF3X3ZlYy9tb2QucnPIABAAUAAAAC4CAAARAAAABAAAAAwAAAAEAAAABQAAAAYAAAAHAAAAL3J1c3QvZGVwcy9kbG1hbGxvYy0wLjIuOC9zcmMvZGxtYWxsb2MucnNhc3NlcnRpb24gZmFpbGVkOiBwc2l6ZSA+PSBzaXplICsgbWluX292ZXJoZWFkAEABEAApAAAArAQAAAkAAABhc3NlcnRpb24gZmFpbGVkOiBwc2l6ZSA8PSBzaXplICsgbWF4X292ZXJoZWFkAABAARAAKQAAALIEAAANAAAAbWVtb3J5IGFsbG9jYXRpb24gb2YgIGJ5dGVzIGZhaWxlZAAA6AEQABUAAAD9ARAADQAAAGxpYnJhcnkvc3RkL3NyYy9hbGxvYy5ycxwCEAAYAAAAZAEAAAkAAAAEAAAADAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAACQAAAAAAAAAIAAAABAAAAAoAAAALAAAADAAAAA0AAAAOAAAAEAAAAAQAAAAPAAAAEAAAABEAAAASAAAAY2FwYWNpdHkgb3ZlcmZsb3cAAACcAhAAEQAAADAwMDEwMjAzMDQwNTA2MDcwODA5MTAxMTEyMTMxNDE1MTYxNzE4MTkyMDIxMjIyMzI0MjUyNjI3MjgyOTMwMzEzMjMzMzQzNTM2MzczODM5NDA0MTQyNDM0NDQ1NDY0NzQ4NDk1MDUxNTI1MzU0NTU1NjU3NTg1OTYwNjE2MjYzNjQ2NTY2Njc2ODY5NzA3MTcyNzM3NDc1NzY3Nzc4Nzk4MDgxODI4Mzg0ODU4Njg3ODg4OTkwOTE5MjkzOTQ5NTk2OTc5ODk5AEGYh8AACwEBAIQBCXByb2R1Y2VycwIIbGFuZ3VhZ2UBBFJ1c3QADHByb2Nlc3NlZC1ieQMFcnVzdGMlMS44OS4wLW5pZ2h0bHkgKDE2ZDIyNzZmYSAyMDI1LTA1LTE2KQZ3YWxydXMGMC4yMy4zDHdhc20tYmluZGdlbhMwLjIuMTAwICgyNDA1ZWMyYjQpAGsPdGFyZ2V0X2ZlYXR1cmVzBisPbXV0YWJsZS1nbG9iYWxzKxNub250cmFwcGluZy1mcHRvaW50KwtidWxrLW1lbW9yeSsIc2lnbi1leHQrD3JlZmVyZW5jZS10eXBlcysKbXVsdGl2YWx1ZQ==",import.meta.url));const e=yt();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:s}=await ht(await r,e);return mt(t,s)}const bt=async r=>({post:{sum:(await vr("../../pkg/ffplotter_web_bg.wasm")).add(2,3)}}),ea=Object.freeze(Object.defineProperty({__proto__:null,load:bt},Symbol.toStringTag,{value:"Module"})),Ar=5824,_r=10205;async function wt(){return"serial"in navigator?navigator.serial.getPorts():Promise.reject(new Error("Web Serial API is not supported in this browser."))}const xt=""+new URL("../assets/ffultra.IuR2TTaS.png",import.meta.url).href;var Et=M("<button><!></button>");function ge(r,e){const t=Oe(e,"onclick",3,()=>{}),s=Oe(e,"extraClasses",3,"");var a=Et();a.__click=function(...n){var f;(f=t())==null||f.apply(this,n)};var i=w(a);at(i,()=>e.children),m(a),V(()=>B(a,1,`bg-teal-500 text-white rounded hover:bg-teal-600 transition-colors cursor-pointer ${s()}`)),x(r,a)}ze(["click"]);var Mt=M('<div class="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 z-50"><div class="p-8 rounded-xl border-teal-300 border-2 flex flex-col items-center justify-center"><h2 class="text-xl text-teal-300">No Fireflies detected.</h2> <img alt="Firefly patch" class="max-w-50 max-h-50"/> <p class="text-gray-200">Please connect a Firefly and press authorize.</p> <!></div></div>');function Nt(r,e){ae(e,!0);var t=Mt(),s=w(t),a=b(w(s),2),i=b(a,4);ge(i,{onclick:()=>{navigator.serial?navigator.serial.requestPort({filters:[{usbVendorId:Ar,usbProductId:_r}]}).then(n=>{e.addPort(n)}).catch(n=>{console.error("Error selecting port:",n)}):alert("Web Serial API is not supported in this browser.")},extraClasses:"px-4 py-2 mt-4",children:(n,f)=>{pe();var l=Mr("Authorize");x(n,l)},$$slots:{default:!0}}),m(s),m(t),V(()=>Ze(a,"src",xt)),x(r,t),se()}class Je{constructor(e){U(this,"port");U(this,"portReady",!1);U(this,"replyHandlers",new Map);U(this,"terminalLineHandler",()=>{});e.open({baudRate:115200}).then(()=>this.portReady=!0).catch(t=>{throw console.error("Failed to open serial port:",t),new Error("Failed to open serial port: "+t.message)}),this.port=e,this.readTask()}setTerminal(e){this.terminalLineHandler=e}async readTask(){for(;;){if(await this.waitForPortReady(),!this.port.readable){console.error("Port is not readable");continue}let e="";console.log("acquiring reader lock");const t=this.port.readable.getReader(),s=new TextDecoder;try{for(;;){const{value:a,done:i}=await t.read();let n=s.decode(a);if(e+=n,i||n.endsWith(`
`))break}}catch(a){throw new Error("Error reading from serial port: "+a)}finally{console.log("Releasing reader lock"),t.releaseLock()}for(let a of e.split(`
`))if(console.log("Received line:",a),a=a.trim(),a.length!==0&&(this.terminalLineHandler(a),a.startsWith("[REPLY#"))){let i=parseInt(a.substring(7,a.indexOf("]"))),n=a.substring(a.indexOf("]")+1).trim();this.replyHandlers.has(i)?this.replyHandlers.get(i)(n):console.warn(`No handler for reply number ${i}`)}}}async waitForPortReady(){return this.portReady?Promise.resolve():new Promise((e,t)=>{const s=()=>{this.portReady?e():setTimeout(s,100)};s()})}async setConfig(e){for(const[t,s]of Object.entries(e)){if(typeof s!="number")return Promise.reject(new Error(`Invalid config value for ${t}: ${s}`));const a=Math.floor(Math.random()*1e4),i=`config,${t},${s},${a}`;await this.sendCommand(i),await new Promise((n,f)=>{this.replyHandlers.set(a,l=>{l.startsWith("ok")?n():(console.error(`Failed to set config ${t}: ${l}`),f(new Error(`Failed to set config ${t}: ${l}`)))})})}}async sendCommand(e){if(await this.waitForPortReady(),!this.port.writable)return console.error("port not writable"),Promise.reject(new Error("Port is not writable"));const t=this.port.writable.getWriter(),s=new TextEncoder;console.log(e),this.terminalLineHandler(e);try{await t.write(s.encode(e))}catch(a){return console.error(a),Promise.reject(new Error("Failed to write to serial port: "+a))}finally{t.releaseLock()}}async getConfig(){const e=Math.floor(Math.random()*1e4);return await this.sendCommand(`dumpconfig,${e}`),new Promise((t,s)=>{this.replyHandlers.set(e,a=>{const i=a.split(",");let n={};for(let f of i){const[l,c]=f.split("=");l&&c&&Object.assign(n,{[l.trim()]:c.trim()})}if(Object.keys(n).length!==6)return console.error("Invalid device config format:",a),s(new Error("Invalid device config format"));t({cr:parseFloat(n.cr),sf:parseFloat(n.sf),rf_freq:parseFloat(n.rf_freq),bw:parseFloat(n.bw),power:parseFloat(n.power),id:parseFloat(n.id)})})})}async getInfo(){const e=Math.floor(Math.random()*1e4);return await this.sendCommand(`info,${e}`),new Promise((t,s)=>{this.replyHandlers.set(e,a=>{const i=a.split(",");if(i.length!==3)return console.error("Invalid device info format:",a),s(new Error("Invalid device info format"));const[n,f,l]=i;t({hardware:n,firmware:f,role:l})})})}}const kt=r=>r;function pr(r){const e=r-1;return e*e*e+1}function Xe(r){const e=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[r,"px"]}function It(r,{delay:e=0,duration:t=400,easing:s=kt}={}){const a=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*a}`}}function Tt(r,{delay:e=0,duration:t=400,easing:s=pr,x:a=0,y:i=0,opacity:n=0}={}){const f=getComputedStyle(r),l=+f.opacity,c=f.transform==="none"?"":f.transform,o=l*(1-n),[g,u]=Xe(a),[_,A]=Xe(i);return{delay:e,duration:t,easing:s,css:(p,h)=>`
			transform: ${c} translate(${(1-p)*g}${u}, ${(1-p)*_}${A});
			opacity: ${l-o*h}`}}function he(r,{delay:e=0,duration:t=400,easing:s=pr,axis:a="y"}={}){const i=getComputedStyle(r),n=+i.opacity,f=a==="y"?"height":"width",l=parseFloat(i[f]),c=a==="y"?["top","bottom"]:["left","right"],o=c.map(d=>`${d[0].toUpperCase()}${d.slice(1)}`),g=parseFloat(i[`padding${o[0]}`]),u=parseFloat(i[`padding${o[1]}`]),_=parseFloat(i[`margin${o[0]}`]),A=parseFloat(i[`margin${o[1]}`]),p=parseFloat(i[`border${o[0]}Width`]),h=parseFloat(i[`border${o[1]}Width`]);return{delay:e,duration:t,easing:s,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*n};${f}: ${d*l}px;padding-${c[0]}: ${d*g}px;padding-${c[1]}: ${d*u}px;margin-${c[0]}: ${d*_}px;margin-${c[1]}: ${d*A}px;border-${c[0]}-width: ${d*p}px;border-${c[1]}-width: ${d*h}px;min-${f}: 0`}}var Ct=async(r,e,t,s,a)=>{(!v(e)||!v(t))&&(T(t,await s.device.getConfig(),!0),T(e,{...v(t)},!0)),T(a,!v(a))},Ft=M('<i class="fas fa-refresh text-xs"></i>'),Zt=M("<div><!></div>"),$t=M('<h3 class="text-teal-300 text-xs p-2"><i class="fas fa-circle-notch fa-spin"></i> Still loading</h3>'),zt=M('<div class="grid grid-cols-[10px_1fr_1fr] gap-2"><i></i> <p class="text-sm text-gray-50 self-center">Radio Frequency</p> <input name="frequency" type="number" class="w-full text-sm bg-gray-900 p-2 mr-2 rounded-xl"/> <i></i> <p class="text-sm text-gray-50 self-center">Board ID</p> <input name="id" type="number" class="w-full text-sm bg-gray-900 p-2 mr-2 rounded-xl"/> <i></i> <p class="text-sm text-gray-50 self-center">Bandwidth</p> <input name="bw" type="number" class="w-full text-sm bg-gray-900 p-2 mr-2 rounded-xl"/> <i></i> <p class="text-sm text-gray-50 self-center">Coding rate</p> <input name="cr" type="number" class="w-full text-sm bg-gray-900 p-2 mr-2 rounded-xl"/> <i></i> <p class="text-sm text-gray-50 self-center">Spreading Factor</p> <input name="sf" type="number" class="w-full text-sm bg-gray-900 p-2 mr-2 rounded-xl"/></div>'),Dt=M('<i class="fas fa-save mr-1"></i> Save',1),Rt=M('<div><hr class="border-teal-500 w-full my-3"/> <!> <div class="flex flex-row-reverse mt-3"><!></div></div>'),Wt=M('<div class="p-3 mb-2 bg-gray-800 rounded-lg"><div class="flex justify-between"><div class="flex"><h3 class="text-teal-300 text-lg"><i class="fas fa-plug text-teal-300"></i> </h3></div> <div class="flex"><h3 class="text-gray-300 text-lg font-mono"> </h3></div></div> <p class="text-gray-300 text-sm"> </p> <div><div class="flex justify-between items-center"><button class="cursor-pointer text-sm transition-all hover:bg-teal-900 w-fit rounded p-1"><i></i> Config</button> <!></div> <!></div></div>'),Bt=M('<div class="p-3 mb-2 bg-gray-800 rounded-lg"><h3 class="text-teal-300 text-lg"><i class="fas fa-circle-notch fa-spin"></i> Still loading</h3></div>'),Pt=M("<div><!></div>");function St(r,e){ae(e,!0);let t=G(!1),s=G(null),a=G(null);const i=l=>!v(a)||!v(s)?"":v(a)[l]===v(s)[l]?"text-teal-500":"text-yellow-500";var n=Pt(),f=w(n);it(f,()=>e.device.getInfo(),l=>{var c=Bt();x(l,c)},(l,c)=>{var o=Wt(),g=w(o),u=w(g),_=w(u),A=b(w(_));m(_),m(u);var p=b(u,2),h=w(p),d=w(h,!0);m(h),m(p),m(g);var y=b(g,2),I=w(y);m(y);var N=b(y,2);B(N,1,`flex flex-col text-teal-300 border-2 border-teal-500
            rounded-md p-2 mt-5`);var k=w(N),C=w(k);C.__click=[Ct,a,s,e,t];var z=w(C);pe(),m(C);var D=b(C,2);{var R=S=>{var Z=Zt(),ie=w(Z);ge(ie,{extraClasses:"px-1",onclick:async()=>{T(s,await e.device.getConfig(),!0),T(a,{...v(s)},!0)},children:(me,De)=>{var ne=Ft();x(me,ne)},$$slots:{default:!0}}),m(Z),j(3,Z,()=>It),x(S,Z)};ve(D,S=>{v(t)&&S(R)})}m(k);var ye=b(k,2);{var gr=S=>{var Z=Rt(),ie=b(w(Z),2);{var me=W=>{var Y=$t();x(W,Y)},De=W=>{var Y=zt(),oe=w(Y),be=b(oe,4);X(be);var Re=b(be,2),we=b(Re,4);X(we);var We=b(we,2),xe=b(We,4);X(xe);var Be=b(xe,2),Ee=b(Be,4);X(Ee);var Pe=b(Ee,2),Se=b(Pe,4);X(Se),m(Y),V((F,yr,mr,br,wr)=>{B(oe,1,F),B(Re,1,yr),B(We,1,mr),B(Be,1,br),B(Pe,1,wr)},[()=>`fas fa-dot-circle self-center text-[0.65rem] m-0 transition-colors duration-300 ${i("rf_freq")}`,()=>`fas fa-dot-circle self-center text-[0.65rem] m-0 ${i("id")}`,()=>`fas fa-dot-circle self-center text-[0.65rem] m-0 ${i("bw")}`,()=>`fas fa-dot-circle self-center text-[0.65rem] m-0 ${i("cr")}`,()=>`fas fa-dot-circle self-center text-[0.65rem] m-0 ${i("sf")}`]),q(be,()=>v(a).rf_freq,F=>v(a).rf_freq=F),q(we,()=>v(a).id,F=>v(a).id=F),q(xe,()=>v(a).bw,F=>v(a).bw=F),q(Ee,()=>v(a).cr,F=>v(a).cr=F),q(Se,()=>v(a).sf,F=>v(a).sf=F),x(W,Y)};ve(ie,W=>{v(a)===null?W(me):W(De,!1)})}var ne=b(ie,2),hr=w(ne);ge(hr,{extraClasses:"px-2",onclick:async()=>{v(a)&&(await e.device.setConfig(v(a)),T(s,await e.device.getConfig(),!0),T(a,{...v(s)},!0))},children:(W,Y)=>{var oe=Dt();pe(),x(W,oe)},$$slots:{default:!0}}),m(ne),m(Z),j(3,Z,()=>he),x(S,Z)};ve(ye,S=>{v(t)&&S(gr)})}m(N),m(o),V(()=>{re(A,` ${v(c).hardware??""}`),re(d,v(c).role),re(I,`Firmware ${v(c).firmware??""}`),B(z,1,`fas fa-chevron-right mr-1 transition-all ${v(t)?"rotate-90":""}`)}),j(3,N,()=>he),x(l,o)}),m(n),j(3,n,()=>Tt,()=>({y:100})),x(r,n),se()}ze(["click"]);var Yt=M('<i class="fa-solid fa-plus"></i> Add',1),Lt=M(`<div class="absolute right-0 top-0 w-100 h-full flex flex-col
	bg-gray-900 z-50 border-l-2 border-teal-300 p-4 overflow-y-scroll"><h2 class="text-teal-200 text-2xl mb-5"><i class="fa-brands fa-usb p-1"></i> Attached Fireflies</h2> <div></div> <div class="w-full"><!></div></div>`);function jt(r,e){ae(e,!0);var t=Lt(),s=b(w(t),2);fr(s,21,()=>e.devices,cr,(n,f)=>{St(n,{get device(){return v(f)}})}),m(s);var a=b(s,2),i=w(a);ge(i,{extraClasses:"w-full",onclick:()=>{navigator.serial?navigator.serial.requestPort({filters:[{usbVendorId:Ar,usbProductId:_r}]}).then(n=>{e.addPort(n)}).catch(n=>{console.error("Error selecting port:",n)}):alert("Web Serial API is not supported in this browser.")},children:(n,f)=>{var l=Yt();pe(),x(n,l)},$$slots:{default:!0}}),m(a),m(t),j(3,s,()=>he),j(3,a,()=>he),x(r,t),se()}var Gt=M('<div class="text-gray-200 bg-gray-800 break-words"> </div>'),Ot=M('<div class="w-full h-full flex flex-col font-mono"><div class="w-full h-10 bg-gray-700 text-teal-300 p-2"> </div> <div class="flex flex-col grow bg-gray-800 overflow-y-scroll p-2"></div> <input name="line" class="w-full h-10 bg-gray-900 text-gray-100 p-2"/></div>');function Qt(r,e){ae(e,!0);let t=G(nr([])),s;e.device.setTerminal(o=>{T(t,[...v(t),o],!0),v(t).length>100&&T(t,v(t).slice(v(t).length-50),!0),setTimeout(()=>{s.scroll({top:s.scrollHeight,behavior:"smooth"})})});let a=G("Loading...");setTimeout(async()=>{const o=await e.device.getInfo();T(a,`${o.hardware} (${o.role})`)},50);var i=Ot(),n=w(i),f=w(n,!0);m(n);var l=b(n,2);fr(l,21,()=>v(t),cr,(o,g)=>{var u=Gt(),_=w(u,!0);m(u),V(()=>re(_,v(g))),x(o,u)}),m(l),rt(l,o=>s=o,()=>s);var c=b(l,2);c.__keydown=o=>{o.key==="Enter"&&(e.device.sendCommand(o.currentTarget.value),o.currentTarget.value="",o.preventDefault())},m(i),V(()=>re(f,v(a))),x(r,i),se()}ze(["keydown"]);var Ht=M('<!> <main class="w-[100vw] h-[100vh]"><!></main>',1);function ra(r,e){ae(e,!0);let t=G(nr([]));(async()=>{let l=await wt();"error"in l?(console.error(l.message),alert(`Error: ${l.message}`)):T(t,l.map(c=>new Je(c)),!0)})();const s=l=>{l.addEventListener("disconnect",()=>{console.log(`Port ${l} disconnected`),T(t,v(t).filter(c=>c.port!==l),!0)}),v(t).push(new Je(l))};var a=Nr(),i=Ge(a);{var n=l=>{var c=Ht(),o=Ge(c);jt(o,{get devices(){return v(t)},addPort:s});var g=b(o,2),u=w(g);Qt(u,{get device(){return v(t)[0]}}),m(g),x(l,c)},f=l=>{Nt(l,{addPort:s})};ve(i,l=>{v(t).length>0?l(n):l(f,!1)})}x(r,a),se()}export{ra as component,ea as universal};
